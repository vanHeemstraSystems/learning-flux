# Repository Directory Structure

This document explains the complete directory structure for the learning-flux repository.

## Full Structure

```
learning-flux/
│
├── README.md                          # Main repository readme
├── FLUX-SETUP.md                      # Flux setup and usage guide
├── DIRECTORY-STRUCTURE.md             # This file
├── Makefile                           # Helper commands for Flux operations
├── .gitignore                         # Git ignore patterns
│
├── 300/                               # Documentation folder
│   ├── README.md                      # Learning materials index
│   ├── 100/
│   │   └── README.md                  # Introduction to Flux and GitOps
│   ├── 200/
│   │   └── README.md                  # Installation and Setup
│   ├── 300/
│   │   └── README.md                  # Core Concepts and Components
│   ├── 400/
│   │   └── README.md                  # GitOps Workflows
│   ├── 500/
│   │   └── README.md                  # Advanced Topics
│   └── 600/
│       └── README.md                  # Practical Examples
│
├── apps/                              # Application manifests
│   └── demo/                          # Demo application
│       ├── deployment.yaml            # Deployment manifest
│       ├── service.yaml               # Service manifest
│       ├── namespace.yaml             # Namespace definition
│       └── kustomization.yaml         # Kustomize config
│
├── infrastructure/                    # Infrastructure components
│   ├── controllers/                   # Ingress, cert-manager, etc.
│   └── configs/                       # ConfigMaps, network policies, etc.
│
├── clusters/                          # Cluster-specific configs
│   └── my-cluster/                    # Your cluster name
│       ├── flux-system/               # Created by flux bootstrap
│       │   ├── gotk-components.yaml   # Flux controllers
│       │   ├── gotk-sync.yaml         # Sync configuration
│       │   └── kustomization.yaml     # Kustomize overlay
│       └── demo-app.yaml              # App Kustomization
│
└── flux-system/                       # Flux source configs
    ├── gitrepository.yaml             # Git source definition
    ├── kustomization.yaml             # Kustomization for demo app
    └── image-automation.yaml          # (Optional) Image automation
```

## Directory Purposes

### Root Level Files

- **README.md**: Overview and quick start guide
- **FLUX-SETUP.md**: Detailed Flux setup instructions
- **Makefile**: Convenience commands for common operations
- **.gitignore**: Files to exclude from version control

### /300 - Documentation

All learning materials organized by topic. Each subdirectory contains a README.md with detailed explanations.

### /apps - Applications

Each subdirectory represents an application with its Kubernetes manifests:

- **Deployments**: Application workload definitions
- **Services**: Network service definitions
- **ConfigMaps/Secrets**: Application configuration
- **kustomization.yaml**: Kustomize overlay for the app

### /infrastructure - Platform Components

Shared infrastructure components that apps depend on:

- **controllers/**: Ingress controllers, service meshes, etc.
- **configs/**: Cluster-wide configurations
- **crds/**: Custom Resource Definitions

### /clusters - Cluster Configurations

Cluster-specific configuration:

- **flux-system/**: Auto-generated by `flux bootstrap`
- **demo-app.yaml**: Kustomization pointing to apps
- **infrastructure.yaml**: Kustomization for infrastructure

### /flux-system - Flux Sources

Source definitions that Flux watches:

- **GitRepository**: Points to this repo
- **Kustomization**: Defines what to deploy
- **ImageRepository/Policy**: (Optional) Image update automation

## Workflow

1. **Developers** make changes to manifests in `/apps`
1. **Commit and push** to the main branch
1. **Flux** detects changes in the GitRepository
1. **Kustomize Controller** applies changes to the cluster
1. **Applications** are updated automatically

## Adding New Applications

To add a new application:

1. Create directory: `apps/my-new-app/`
1. Add manifests: `deployment.yaml`, `service.yaml`, etc.
1. Create `apps/my-new-app/kustomization.yaml`
1. Add Flux Kustomization in `clusters/my-cluster/my-new-app.yaml`:

```yaml
---
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: my-new-app
  namespace: flux-system
spec:
  interval: 10m0s
  path: ./apps/my-new-app
  prune: true
  sourceRef:
    kind: GitRepository
    name: flux-system
```

1. Commit and push - Flux handles the rest!

## Environment-Specific Configurations

For multiple environments (dev, staging, prod):

```
apps/
└── my-app/
    ├── base/                    # Common resources
    │   ├── deployment.yaml
    │   ├── service.yaml
    │   └── kustomization.yaml
    └── overlays/                # Environment-specific
        ├── dev/
        │   └── kustomization.yaml
        ├── staging/
        │   └── kustomization.yaml
        └── production/
            └── kustomization.yaml
```

Then point Flux Kustomizations to the appropriate overlay path:

- Dev: `./apps/my-app/overlays/dev`
- Staging: `./apps/my-app/overlays/staging`
- Production: `./apps/my-app/overlays/production`

## Best Practices

1. **Keep apps isolated**: Each app in its own directory
1. **Use Kustomize overlays**: For environment-specific configs
1. **Version everything**: All changes tracked in Git
1. **Test in dev first**: Progressive deployment across environments
1. **Use health checks**: Ensure deployments are successful
1. **Document changes**: Clear commit messages

## Next Steps

- See [FLUX-SETUP.md](./FLUX-SETUP.md) for bootstrap instructions
- Read [300/README.md](./300/README.md) to learn Flux concepts
- Explore the demo app in [apps/demo/](./apps/demo/)
